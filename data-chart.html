<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>数据统计分析</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="css/user/global.css">
    <link rel="stylesheet" href="css/user/navigator.css">
    <link href="css/select2.css" rel="stylesheet"/>

    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
<div class="container-fluid">
    <div class="header">
        <nav class=" navbar navbar-default navbar-fixed-top" id="top-navbar" role="navigation">
            <div class="navbar-brand">
                <a href="index.html">
                    <img src="images/logo.png" alt="Campus" class="img-responsive" height="30" width="120">
                </a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav pull-right">
                    <li class="dropdown user" id="header-user">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <img alt="" src="images/avatar3.jpg"/>
                            <span class="username">辅导员</span>
                            <i class="fa fa-angle-down"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="#"><i class="fa fa-user"></i>用户信息</a></li>
                            <li><a href="#"><i class="fa fa-comment"></i>消息</a></li>
                            <li><a href="#"><i class="fa fa-eye"></i>预留</a></li>
                            <li><a href="login.html"><i class="fa fa-power-off"></i>注销</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
    <div class="main row">
        <div class="col-lg-2 left-part">
            <nav class="left-nav navbar-left col-md-12 " role="navigation">
                <a href="#base" class="nav-header menu-first collapse navbar-collapse" data-toggle="collapse"><i
                        class="fa fa-user"></i>&nbsp;个人信息</a>
                <ul class="nav nav-list collapse menu-second in" id="base">
                    <li role="presentation"><a href="perfect-information.html"><i class="fa fa-edit"></i>&nbsp;完善信息</a>
                    </li>
                    <li role="presentation"><a href="change-password.html"><i class="fa fa-key"></i>&nbsp;修改密码</a></li>
                </ul>
                <a href="#message" class="nav-header menu-first collapse navbar-collapse" data-toggle="collapse">
                    <i class="fa fa-comment"></i>&nbsp;消息通知
                </a>
                <ul class="nav nav-list collapse menu-second in " id="message">
                    <li role="presentation"><a href="message.html"><i class="fa fa-comments"></i>&nbsp;临时会话</a></li>
                    <li role="presentation"><a href="email.html"><i class="fa fa-envelope"></i>&nbsp;邮件系统</a></li>
                </ul>
                <a href="#manage" class="nav-header menu-first collapse navbar-collapse" data-toggle="collapse">
                    <i class="fa fa-wrench"></i>&nbsp;操作管理
                </a>
                <ul class="nav nav-list collapse menu-second in " id="manage">
                    <li><a href="record-in.html"><i class="fa fa-pencil"></i>&nbsp;信息录入</a></li>
                    <li><a href="file-upload.html"><i class="fa fa-upload"></i>&nbsp;文件上传</a></li>
                    <li><a href="activity-create.html"><i class="fa fa-plus"></i>&nbsp;活动创建</a></li>
                    <li><a href="activity-checkin.html"><i class="fa fa-paperclip"></i>&nbsp;活动审批</a></li>
                </ul>
                <a href="#data" class="nav-header menu-first collapse navbar-collapse" data-toggle="collapse"><i
                        class="fa fa-bar-chart"></i>&nbsp;数据分析</a>
                <ul class="nav nav-list collapse menu-second in " id="data">
                    <li><a href="data-chart.html"><i class="fa fa-pie-chart"></i>&nbsp;数据统计</a></li>
                    <li><a href="data-table.html"><i class="fa fa-table"></i>&nbsp;数据报表</a></li>
                    <li><a href="#"><i class="fa fa-pencil"></i>&nbsp;预留</a></li>
                </ul>
                <a href="#reserve" class="nav-header menu-first collapse navbar-collapse" data-toggle="collapse"><i
                        class="icon-book icon-large"></i>&nbsp;预留</a>
                <ul class="nav nav-list collapse menu-second " id="reserve">
                    <li><a href="#"><i class="fa fa-pencil"></i>&nbsp;one</a></li>
                    <li><a href="#"><i class="fa fa-pencil"></i>&nbsp;two</a></li>
                    <li><a href="#"><i class="fa fa-pencil"></i>&nbsp;>three</a></li>
                </ul>
            </nav>
        </div>
        <div class="col-lg-offset-2 col-lg-9 domain-part">
            <div class="content col-md-12">
                    <div class="content-header">
                        <h2><i class="fa fa-pie-chart"></i> 数据分析</h2>
                    </div>
                    <div class="content-breadcrumb">
                        <ul class="breadcrumb">
                            <li><a href="index.html"><i class="fa fa-home"></i> 主页</a> <span class="divider"></span></li>
                            <li class="active">数据分析</li>
                        </ul>
                    </div>
                    <div class="content-body">
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                <div class="header-control pull-right">
                                    <a data-box="collapse" href="#"><i class="fa fa-caret-up"></i></a>
                                    <a data-box="refresh" href="#"><i class="fa fa-refresh"></i></a>
                                </div>
                                <ul class="nav nav-tabs" id="tab-stat">
                                    <li class="active"><a data-toggle="tab" href="#enrollMembers">报到人数统计</a></li>
                                    <li><a data-toggle="tab" href="#enrollTime">报到时间统计</a></li>
                                    <li><a data-toggle="tab" href="#enrollVehicle">交通工具统计</a></li>
                                </ul>
                            </div>
                            <div class="panel-body">
                                <div class="tab-content">
                                    <div class="tab-pane fade in active" id="enrollMembers" page="1">
                                        <div class="row">
                                            <div class="col-lg-8">
                                                <canvas id="enrollMembersBar" width="400" height="200"></canvas>
                                            </div>
                                            <div class="col-lg-4">
                                                <canvas id="enrollMembersPie" width="200" height="200"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="enrollTime" page="2">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <canvas id="enrollTimeBar" width="400" height="200"></canvas>
                                            </div>
                                            <div class="col-md-4">
                                                <canvas id="enrollTimePie" width="400" height="200"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="enrollVehicle" page="3">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <canvas id="enrollVehicleBar" width="400" height="200"></canvas>
                                            </div>
                                            <div class="col-md-4">
                                                <canvas id="enrollVehiclePie" width="400" height="200"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="divider-content"><span></span></div>
                        <div id="tablePanel" class="panel panel-primary">
                            <div class="panel-heading" style="height: 40px">
                                <a href="#emailAll" class="btn btn-primary btn-sm" data-toggle="tooltip"
                                   style="margin-top:-5px;width: 40px"
                                   title="email all"><i class="fa fa-envelope"></i></a>
                                <div class="header-control pull-right">
                                    <a data-box="collapse" href="#"><i class="fa fa-caret-up"></i></a>
                                </div>
                            </div>
                            <div class="panel-body">
                                <table id="studentsTable" class="table table-striped table-bordered" width="100%"
                                       cellspacing="0">
                                    <thead>
                                    <tr>
                                        <th>姓名</th>
                                        <th>性别</th>
                                        <th>电话</th>
                                        <th>邮箱</th>
                                        <th>报到状态</th>
                                        <th>交通工具</th>
                                        <th>通知</th>
                                    </tr>
                                    </thead>
                                    <tfoot>
                                    <tr>
                                        <th>姓名</th>
                                        <th>性别</th>
                                        <th>电话</th>
                                        <th>邮箱</th>
                                        <th>报到状态</th>
                                        <th>交通工具</th>
                                        <th>通知</th>
                                    </tr>
                                    </tfoot>
                                </table>
                            </div>

                        </div>
                        <div class="divider-content"><span></span></div>
                        <div class="panel panel-primary">
                            <div class="panel-heading">
                                <div class="header-control pull-right">
                                    <a data-box="collapse" href="#"><i class="fa fa-caret-up"></i></a>
                                </div>
                                <span><i class="fa fa-envelope"></i> Quick Mail</span>
                            </div>
                            <div class="panel-body">
                                <form class="form-horizontal" role="form">
                                    <div class="form-group">
                                        <label class="col-md-2 control-label">收件人</label>
                                        <div class="col-md-8">
                                            <input type="hidden" id="receiver" name="receiver" data-form="select2"
                                                   value="johndoe@mail.com, janedoe@mail.com, johnsmith@mail.com, janesmith@mail.com"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-2 control-label">主题</label>
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" name="subject"/>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-2 control-label">内容</label>
                                        <div class="col-md-8">
                                                 <textarea name="message" data-form="wysihtml5" rows="6"
                                                           class="col-md-12 form-control"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-offset-3">
                                            <input type="reset" class="btn btn-info" value="重置"/>
                                            <input type="submit" class="btn btn-primary" value="提交"/>
                                        </div>

                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
        <div class="col-lg-1 right-part"></div>
    </div>
</div>
<script src="js/jquery-2.2.0.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/dataTables.bootstrap.min.js"></script>
<script type="text/javascript">
    jQuery.browser = {};
    (function () {
        jQuery.browser.msie = false;
        jQuery.browser.version = 0;
        if (navigator.userAgent.match(/MSIE ([0-9]+)./)) {
            jQuery.browser.msie = true;
            jQuery.browser.version = RegExp.$1;
        }
    })();
</script>
<script src="js/wysihtml5/wysihtml5-0.3.0.js"></script>
<script src="js/wysihtml5/bootstrap-wysihtml5.js"></script>
<script src="js/Chart.min.js"></script>
<script src="js/select2.js"></script>
<script type="text/javascript">
    /**请求图表数据*/
    var chartReq = function (page) {
        $.ajax({
            url: 'management/chartData?page=' + page,// action
//            data:{
//                selRollBack : selRollBack,
//                selOperatorsCode : selOperatorsCode,
//                PROVINCECODE : PROVINCECODE,
//                pass2 : pass2
//            },
            type: 'post',
            cache: false,
            dataType: 'json',
            success: function (data) {
                $.each(firstTabBarData.datasets, function(i, dataset) {
                    dataset.data = dataset.data.map(function() {
                        return data;
                    });
                });
                EnrollMembersBarChart.update();
            },
            error: function () {
                alert("加载数据异常！");
            }
        });
    };
    $(document).ready(function () {
        // 请求图表数据
        var firstTabBarData = {
            labels: ["已报到", "已出发", "未出发"],
            datasets: [
                {
                    fillColor: "rgba(101,17,25,0.5)",
                    strokeColor: "rgba(151,187,205,1)",
                    data: [28, 48, 90]
                }
            ]
        };
        var firstCtxBar = $("#enrollMembersBar").get(0).getContext("2d");
        var EnrollMembersBarChart = new Chart(firstCtxBar);
        EnrollMembersBarChart.Bar(firstTabBarData);

        var firstTabPieData = [
            {
                label: "已报到",
                value: 30,
                color: "#F38630"
            },
            {
                label: "已出发",
                value: 50,
                color: "#E0E4CC"
            },
            {
                label: "未出发",
                value: 100,
                color: "#69D2E7"
            }
        ]
        var firstCtxPie = $("#enrollMembersPie").get(0).getContext("2d");
        var EnrollMembersPieChart = new Chart(firstCtxPie);
        EnrollMembersPieChart.Pie(firstTabPieData);

        var secondTabBarData = {
            labels: ["8月29", "8月30", "8月31", "9月1", "9月2", "9月3", "9月4", "其他"],
            datasets: [
                {
                    fillColor: "rgba(101,17,25,0.5)",
                    strokeColor: "rgba(151,187,205,1)",
                    data: [18, 28, 30, 90, 23, 12, 5, 9]
                }
            ]
        };
        var secondCtxBar = $("#enrollTimeBar").get(0).getContext("2d");
        var EnrollMembersBarChart = new Chart(secondCtxBar);
        EnrollMembersBarChart.Bar(secondTabBarData);

        var secondTabPieData = [
            {
                label: "8月29",
                value: 18,
                color: "#F38630"
            },
            {
                label: "8月30",
                value: 28,
                color: "#E0E4CC"
            },
            {
                label: "8月31",
                value: 30,
                color: "#498217"
            },
            {
                label: "9月1",
                value: 90,
                color: "#F972E7"
            },
            {
                label: "9月2",
                value: 23,
                color: "#395287"
            },
            {
                label: "9月3",
                value: 12,
                color: "#792217"
            },
            {
                label: "9月4",
                value: 5,
                color: "#29D267"
            },
            {
                label: "其他",
                value: 9,
                color: "#1912E7"
            }
        ]
        var secondCtxPie = $("#enrollTimePie").get(0).getContext("2d");
        var EnrollMembersPieChart = new Chart(secondCtxPie);
        EnrollMembersPieChart.Pie(secondTabPieData);

        var thirdTabBarData = {
            labels: ["客车", "火车", "自驾", "飞机", "其他"],
            datasets: [
                {
                    fillColor: "rgba(101,17,25,0.5)",
                    strokeColor: "rgba(151,187,205,1)",
                    data: [28, 48, 90, 7, 26]
                }
            ]
        };
        var thirdCtxBar = $("#enrollVehicleBar").get(0).getContext("2d");
        var EnrollVehicleBarChart = new Chart(thirdCtxBar);
        EnrollVehicleBarChart.Bar(thirdTabBarData);

        var thirdTabPieData = [
            {
                label: "客车",
                value: 28,
                color: "#F38630"
            },
            {
                label: "火车",
                value: 48,
                color: "#E0E4CC"
            },
            {
                label: "自驾",
                value: 90,
                color: "#20E4CC"
            },
            {
                label: "飞机",
                value: 7,
                color: "#89D2E7"
            },
            {
                label: "其他",
                value: 26,
                color: "#9952E7"
            }
        ]
        var thirdCtxPie = $("#enrollVehiclePie").get(0).getContext("2d");
        var EnrollVehiclePieChart = new Chart(thirdCtxPie);
        EnrollVehiclePieChart.Pie(thirdTabPieData);

        // normalize event tab-stat, we hack something here couse the flot re-draw event is any some bugs for this case
        $('#tab-stat > a[data-toggle="tab"]').on('shown', function () {
            if (sessionStorage.mode == 4) { // this hack only for mode side-only
                $('body,html').animate({
                    scrollTop: 0
                }, 'slow');
            }
        });

        $('[data-form=select2]').select2({
            tags: ['Tony@sina.com', 'Majun@sina.com', 'JSexy@hotmail.com']
        });
        $('.header-control [data-box=refresh]').click(function(){
            var collapse = $(this);
            var panel = collapse.parent().parent().parent();
            var page=panel.find('.panel-body').find('.active').attr("page");
            chartReq(page);
        });
        // tootips chart
//        function showTooltip(x, y, contents) {
//            $('<div id="tooltip" class="bg-black corner-all color-white">' + contents + '</div>').css({
//                position: 'absolute',
//                display: 'none',
//                top: y + 5,
//                left: x + 5,
//                border: '0px',
//                padding: '2px 10px 2px 10px',
//                opacity: 0.9,
//                'font-size': '11px'
//            }).appendTo("body").fadeIn(8000);
//        };
    });
</script>
</body>
</html>